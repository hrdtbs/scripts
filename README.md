# scripts

### list-repos-in-org

çµ„ç¹”ã®ãƒªãƒã‚¸ãƒˆãƒªä¸€è¦§ã‚’å–å¾—ã—ã€JSONãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å‡ºåŠ›ã—ã¾ã™ã€‚

```bash
deno task start src/list-repos-in-org/index.ts --org=org-name [--output=å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª]
```

#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³

- `--org`: ï¼ˆå¿…é ˆï¼‰GitHubã®çµ„ç¹”å
- `--output`: ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ‘ã‚¹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: `.output`ï¼‰

#### å‡ºåŠ›

æŒ‡å®šã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« `{çµ„ç¹”å}-repos.json` ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚
ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ä»¥ä¸‹ã®æƒ…å ±ãŒå«ã¾ã‚Œã¾ã™ï¼š

```json
{
  "organization": "çµ„ç¹”å",
  "timestamp": "ç”Ÿæˆæ—¥æ™‚",
  "repositories": [
    {
      "name": "ãƒªãƒã‚¸ãƒˆãƒªå",
      "fullName": "çµ„ç¹”å/ãƒªãƒã‚¸ãƒˆãƒªå",
      "url": "ãƒªãƒã‚¸ãƒˆãƒªã®URL",
      "description": "ãƒªãƒã‚¸ãƒˆãƒªã®èª¬æ˜",
      "isPrivate": true/false,
      "createdAt": "ä½œæˆæ—¥æ™‚",
      "updatedAt": "æ›´æ–°æ—¥æ™‚",
      "language": "ä¸»è¦ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èª"
    }
  ]
}
```

### list-dependabot-alerts

çµ„ç¹”å†…ã®å…¨ãƒªãƒã‚¸ãƒˆãƒªã®Dependabotã‚¢ãƒ©ãƒ¼ãƒˆã‚’å–å¾—ã—ã€JSONãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å‡ºåŠ›ã—ã¾ã™ã€‚

```bash
deno task start src/list-dependabot-alerts/index.ts --org=org-name [--output=å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª] [--state=ã‚¢ãƒ©ãƒ¼ãƒˆã®çŠ¶æ…‹] [--format=å‡ºåŠ›å½¢å¼]
```

#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³

- `--org`: ï¼ˆå¿…é ˆï¼‰GitHubã®çµ„ç¹”å
- `--output`: ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ‘ã‚¹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: `.output`ï¼‰
- `--state`: ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ã‚¢ãƒ©ãƒ¼ãƒˆã®çŠ¶æ…‹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: `open`ï¼‰
  - `open`: æœªè§£æ±ºã®ã‚¢ãƒ©ãƒ¼ãƒˆ
  - `closed`: è§£æ±ºæ¸ˆã¿ã®ã‚¢ãƒ©ãƒ¼ãƒˆ
  - `dismissed`: å´ä¸‹ã•ã‚ŒãŸã‚¢ãƒ©ãƒ¼ãƒˆ
  - `fixed`: ä¿®æ­£æ¸ˆã¿ã®ã‚¢ãƒ©ãƒ¼ãƒˆ
- `--format`: ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰å‡ºåŠ›å½¢å¼ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: `json`ï¼‰
  - `json`: JSONå½¢å¼ã§å‡ºåŠ›
  - `csv`: CSVå½¢å¼ã§å‡ºåŠ›

#### å¿…è¦ãªæ¨©é™

GitHubãƒˆãƒ¼ã‚¯ãƒ³ã«ã¯ä»¥ä¸‹ã®æ¨©é™ãŒå¿…è¦ã§ã™ï¼š
- `repo`: ãƒªãƒã‚¸ãƒˆãƒªã¸ã®ãƒ•ãƒ«ã‚¢ã‚¯ã‚»ã‚¹
- `security_events`: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã®èª­ã¿å–ã‚Š

#### å‡ºåŠ›

æŒ‡å®šã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä»¥ä¸‹ã®2ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã™ï¼š

1. `{çµ„ç¹”å}-dependabot-alerts.{json|csv}`: ã‚¢ãƒ©ãƒ¼ãƒˆæƒ…å ±
   - `--format=json`ã®å ´åˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰:
   ```json
   [
     {
       "organization": "çµ„ç¹”å",
       "timestamp": "ç”Ÿæˆæ—¥æ™‚",
       "state": "ã‚¢ãƒ©ãƒ¼ãƒˆã®çŠ¶æ…‹",
       "repository": "ãƒªãƒã‚¸ãƒˆãƒªå",
       "number": "ã‚¢ãƒ©ãƒ¼ãƒˆç•ªå·",
       "alert_id": "ã‚¢ãƒ©ãƒ¼ãƒˆID",
       "dependency": {
         "package": {
           "ecosystem": "ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ",
           "name": "ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å"
         },
         "manifest_path": "ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹",
         "scope": "ä¾å­˜é–¢ä¿‚ã®ã‚¹ã‚³ãƒ¼ãƒ—",
         "relationship": "ä¾å­˜é–¢ä¿‚ã®ç¨®é¡"
       },
       "severity": "æ·±åˆ»åº¦ï¼ˆcritical/high/medium/lowï¼‰",
       "summary": "æ¦‚è¦",
       "description": "è©³ç´°ãªèª¬æ˜",
       "vulnerableVersionRange": "è„†å¼±æ€§ã®ã‚ã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¯„å›²",
       "firstPatchedVersion": "æœ€åˆã®ä¿®æ­£ãƒãƒ¼ã‚¸ãƒ§ãƒ³",
       "createdAt": "ä½œæˆæ—¥æ™‚",
       "updatedAt": "æ›´æ–°æ—¥æ™‚"
     }
   ]
   ```

   - `--format=csv`ã®å ´åˆ:
   ```csv
   organization,timestamp,state,repository,number,alert_id,package_ecosystem,package_name,manifest_path,scope,relationship,severity,summary,vulnerable_version_range,first_patched_version,created_at,updated_at
   çµ„ç¹”å,ç”Ÿæˆæ—¥æ™‚,ã‚¢ãƒ©ãƒ¼ãƒˆã®çŠ¶æ…‹,ãƒªãƒã‚¸ãƒˆãƒªå,ã‚¢ãƒ©ãƒ¼ãƒˆç•ªå·,ã‚¢ãƒ©ãƒ¼ãƒˆID,ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ,ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å,ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹,ä¾å­˜é–¢ä¿‚ã®ã‚¹ã‚³ãƒ¼ãƒ—,ä¾å­˜é–¢ä¿‚ã®ç¨®é¡,æ·±åˆ»åº¦,æ¦‚è¦,è„†å¼±æ€§ã®ã‚ã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¯„å›²,æœ€åˆã®ä¿®æ­£ãƒãƒ¼ã‚¸ãƒ§ãƒ³,ä½œæˆæ—¥æ™‚,æ›´æ–°æ—¥æ™‚
   ```

2. `{çµ„ç¹”å}-dependabot-errors.json`: ã‚¨ãƒ©ãƒ¼æƒ…å ±
```json
{
  "organization": "çµ„ç¹”å",
  "timestamp": "ç”Ÿæˆæ—¥æ™‚",
  "summary": {
    "totalErrors": "ã‚¨ãƒ©ãƒ¼ã®ç·æ•°",
    "dependabotDisabled": "DependabotãŒç„¡åŠ¹ãªãƒªãƒã‚¸ãƒˆãƒªæ•°",
    "noAccess": "ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒãªã„ãƒªãƒã‚¸ãƒˆãƒªæ•°",
    "otherErrors": "ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼æ•°"
  },
  "errors": {
    "dependabotDisabled": [
      {
        "repository": "ãƒªãƒã‚¸ãƒˆãƒªå",
        "reason": "ã‚¨ãƒ©ãƒ¼ã®ç†ç”±",
        "settingsUrl": "è¨­å®šãƒšãƒ¼ã‚¸ã®URL"
      }
    ],
    "noAccess": [
      {
        "repository": "ãƒªãƒã‚¸ãƒˆãƒªå",
        "reason": "ã‚¨ãƒ©ãƒ¼ã®ç†ç”±"
      }
    ],
    "otherErrors": [
      {
        "repository": "ãƒªãƒã‚¸ãƒˆãƒªå",
        "reason": "ã‚¨ãƒ©ãƒ¼ã®ç†ç”±"
      }
    ]
  }
}
```

ã¾ãŸã€å®Ÿè¡Œçµæœã®ã‚µãƒãƒªãƒ¼ãŒã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ã•ã‚Œã¾ã™ï¼š
```
ğŸ“Š ã‚µãƒãƒªãƒ¼:
- æ¤œæŸ»ã—ãŸãƒªãƒã‚¸ãƒˆãƒªæ•°: ç·æ•°
  - ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½: æˆåŠŸæ•°
    - ã‚¢ãƒ©ãƒ¼ãƒˆã‚ã‚Š: ã‚¢ãƒ©ãƒ¼ãƒˆãŒã‚ã‚‹ãƒªãƒã‚¸ãƒˆãƒªæ•°
    - ç·ã‚¢ãƒ©ãƒ¼ãƒˆæ•°: ã‚¢ãƒ©ãƒ¼ãƒˆã®ç·æ•°
      - Critical: é‡å¤§åº¦ã®ã‚¢ãƒ©ãƒ¼ãƒˆæ•°
      - High: é«˜é‡è¦åº¦ã®ã‚¢ãƒ©ãƒ¼ãƒˆæ•°
      - Medium: ä¸­é‡è¦åº¦ã®ã‚¢ãƒ©ãƒ¼ãƒˆæ•°
      - Low: ä½é‡è¦åº¦ã®ã‚¢ãƒ©ãƒ¼ãƒˆæ•°
  - ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯: ã‚¨ãƒ©ãƒ¼æ•°
    - Dependabotç„¡åŠ¹: DependabotãŒç„¡åŠ¹ãªãƒªãƒã‚¸ãƒˆãƒªæ•°
    - ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãªã—: ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒãªã„ãƒªãƒã‚¸ãƒˆãƒªæ•°
    - ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼: ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼æ•°
```

### create-issue

```bash
deno run --allow-env --allow-net src/create-issue/index.ts --repo=repo-name
```

### list-renovate-status

çµ„ç¹”å†…ã®ãƒªãƒã‚¸ãƒˆãƒªã®Renovateã®æœ‰åŠ¹åŒ–çŠ¶æ³ã‚’ç¢ºèªã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã™ã€‚å„ãƒªãƒã‚¸ãƒˆãƒªã®Dependency Dashboardã‚’è§£æã—ã€ä¾å­˜é–¢ä¿‚ã®æ›´æ–°çŠ¶æ³ã‚’ã‚°ãƒ«ãƒ¼ãƒ—ã”ã¨ã«é›†è¨ˆã—ã¾ã™ã€‚

```bash
deno task start src/list-renovate-status/index.ts --org=çµ„ç¹”å [--output=å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª]
```

#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³

- `--org`: å¿…é ˆã€‚å¯¾è±¡ã®çµ„ç¹”å
- `--output`: ä»»æ„ã€‚å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: `.output`ï¼‰

#### å‡ºåŠ›å½¢å¼

`${org}-renovate-status.json`ãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã®å½¢å¼ã§å‡ºåŠ›ã•ã‚Œã¾ã™ï¼š

```json
{
  "organization": "çµ„ç¹”å",
  "timestamp": "2024-03-11T12:34:56.789Z",
  "summary": {
    "totalRepositories": 10,
    "enabledRepositories": 5,
    "disabledRepositories": 5,
    "totalManagedDependencies": 100
  },
  "repositories": {
    "enabled": [
      {
        "name": "repo-name",
        "dependencyCount": 20,
        "dashboardUrl": "https://github.com/org/repo/issues/1",
        "dependencyGroups": [
          {
            "title": "Rate-Limited",
            "count": 10,
            "dependencies": [
              "@types/node",
              "cloud.google.com/go/videointelligence",
              // ...
            ]
          },
          {
            "title": "Open",
            "count": 5,
            "dependencies": [
              "github.com/arran4/golang-ical",
              // ...
            ]
          },
          {
            "title": "Ignored or Blocked",
            "count": 5,
            "dependencies": [
              "github.com/matsuri-tech/date-go/v2",
              // ...
            ]
          }
        ]
      }
    ],
    "disabled": [
      {
        "name": "repo-name"
      }
    ]
  }
}
```

ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ã§ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå½¢å¼ã§ã‚µãƒãƒªãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

```
ğŸ“Š ã‚µãƒãƒªãƒ¼:
- æ¤œæŸ»ã—ãŸãƒªãƒã‚¸ãƒˆãƒªæ•°: 10
  - Renovateæœ‰åŠ¹: 5
    - ç®¡ç†å¯¾è±¡ã®ä¾å­˜é–¢ä¿‚æ•°: 100
    - Rate-Limited: 50
    - Open: 30
    - Ignored or Blocked: 20
  - Renovateç„¡åŠ¹: 5
```

### search-actions-in-org

çµ„ç¹”å†…ã®å…¨ãƒªãƒã‚¸ãƒˆãƒªã®GitHub Actionsä½¿ç”¨çŠ¶æ³ã‚’åˆ†æã—ã€ç‰¹å®šã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ç›´æ¥çš„ãƒ»é–“æ¥çš„ãªä½¿ç”¨çŠ¶æ³ã‚’JSONãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å‡ºåŠ›ã—ã¾ã™ã€‚

```bash
deno task start src/search-actions-in-org/index.ts --org=org-name --action=action-name [--output=å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª]
```

#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³

- `--org`: ï¼ˆå¿…é ˆï¼‰GitHubã®çµ„ç¹”å
- `--action`: ï¼ˆå¿…é ˆï¼‰æ¤œç´¢å¯¾è±¡ã®GitHub Actionï¼ˆä¾‹: `actions/checkout`ï¼‰
- `--output`: ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ‘ã‚¹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: `.output`ï¼‰

#### å¿…è¦ãªæ¨©é™

GitHubãƒˆãƒ¼ã‚¯ãƒ³ã«ã¯ä»¥ä¸‹ã®æ¨©é™ãŒå¿…è¦ã§ã™ï¼š
- `repo`: ãƒªãƒã‚¸ãƒˆãƒªã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™

#### å‡ºåŠ›

æŒ‡å®šã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« `{çµ„ç¹”å}-action-usage.json` ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚
ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ä»¥ä¸‹ã®æƒ…å ±ãŒå«ã¾ã‚Œã¾ã™ï¼š

```json
{
  "organization": "çµ„ç¹”å",
  "timestamp": "ç”Ÿæˆæ—¥æ™‚",
  "targetAction": "æ¤œç´¢å¯¾è±¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³",
  "summary": {
    "totalRepositories": "ã‚¹ã‚­ãƒ£ãƒ³ã—ãŸãƒªãƒã‚¸ãƒˆãƒªã®ç·æ•°",
    "repositoriesScanned": "ã‚¹ã‚­ãƒ£ãƒ³ã«æˆåŠŸã—ãŸãƒªãƒã‚¸ãƒˆãƒªæ•°",
    "repositoriesWithDirectUsage": "ç›´æ¥ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒªãƒã‚¸ãƒˆãƒªæ•°",
    "repositoriesWithIndirectUsage": "é–“æ¥çš„ã«ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒªãƒã‚¸ãƒˆãƒªæ•°",
    "totalDirectUsages": "ç›´æ¥ä½¿ç”¨ã®ç·æ•°",
    "totalIndirectUsages": "é–“æ¥çš„ãªä½¿ç”¨ã®ç·æ•°"
  },
  "directUsages": [
    {
      "repo": "ãƒªãƒã‚¸ãƒˆãƒªå",
      "workflow": "ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹"
    }
  ],
  "indirectUsages": {
    "ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å": [
      {
        "repo": "ãƒªãƒã‚¸ãƒˆãƒªå",
        "workflow": "ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹"
      }
    ]
  },
  "errors": {
    "accessErrors": ["ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸãƒªãƒã‚¸ãƒˆãƒª"],
    "scanErrors": ["ã‚¹ã‚­ãƒ£ãƒ³ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸãƒªãƒã‚¸ãƒˆãƒª"]
  }
}
```

ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ã§ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå½¢å¼ã§ã‚µãƒãƒªãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

```
ğŸ“Š ã‚µãƒãƒªãƒ¼:
- ç›´æ¥ä½¿ç”¨:
  - ãƒªãƒã‚¸ãƒˆãƒªæ•°: 10
  - ä½¿ç”¨å›æ•°: 15
- é–“æ¥çš„ãªä½¿ç”¨:
  - ãƒªãƒã‚¸ãƒˆãƒªæ•°: 5
  - ä½¿ç”¨å›æ•°: 8
  - ä½¿ç”¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ•°: 3
```
